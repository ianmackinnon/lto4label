<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   width="${width}mm"
   height="${height}mm"
   version="1.1"
   style="font-family:freesans, sans">
<%
x = margin
y = margin
%>
  %while labels:
<%
label = labels.pop()
assert x + 78 < (width - margin), "Too many for page"
if  y + 17 > (height - margin):
    x += 78 + margin
    y = margin
%>
  ${render_label(label, x, y)}
<%
y += 17 + margin
%>
  %endwhile

</svg>


<%def name="render_label(label, x, y)">

  <g transform="translate(${mm_to_px(x)},${mm_to_px(y)})">
    <rect ry="1mm" rx="1mm" y="0" x="0" height="17mm" width="78mm" style="fill:none;stroke:black;stroke-opacity:.2;stroke-width:0.1mm;" />
    <g transform="scale(1.55,1)">
<%
cx = 10
%>    
%for f in label.code_39:
%if f in 'bB':
      <rect y="0" x="${cx}" height="17mm" width="${1 + 2 * int(f == "B")}" style="fill:black;stroke-width:0;" />
%endif
<%
cx += 1 + 2 * int(f in "BW") 
%> \
%endfor
    </g>

<%
nwidth = 10.3
nx = 3
%>
%for n, color in label.color_numbers:
    <rect y="0" x="${nx}mm" height="5mm" width="${nwidth}mm" style="fill:${color};stroke:#000000;stroke-width:0.1mm;" />
    <text y="3.9mm" x="${nx + nwidth / 2}mm" style="font-size:4mm; text-anchor: middle;">${n}</text>
<%
nx += nwidth
%>
%endfor
    <rect y="0" x="${nx}mm" height="5mm" width="${nwidth}mm" style="fill:white;stroke:#000000;stroke-width:0.1mm;" />
    <text y="3.3mm" x="${nx + nwidth / 2}mm" style="font-size:2.5mm; text-anchor: middle;">L4</text>
  </g>


</%def>

<%def name="mm_to_px(mm)">
${mm * 90 / 25.4}
</%def>
